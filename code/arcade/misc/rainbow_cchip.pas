unit rainbow_cchip;

interface

uses
  WinApi.Windows,
  main_engine,
  timer_engine,
  controls_engine;

const
  cram_bank1: array [0 .. 320] of byte = ($01, $00, $00, $00, $00, $01, $01, $01, $01, $01, $01,
    $01, $01, $01, $01, $02, $0A, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $02, $0A, $0C,
    $01, $01, $01, $01, $01, $01, $01, $01, $01, $02, $0A, $0B, $01, $01, $01, $01, $01, $01, $01,
    $01, $01, $02, $07, $08, $09, $01, $01, $01, $01, $01, $01, $01, $01, $02, $07, $08, $08, $01,
    $01, $01, $01, $01, $01, $01, $01, $02, $07, $08, $08, $09, $01, $01, $01, $01, $01, $01, $01,
    $02, $07, $08, $08, $08, $01, $01, $01, $01, $01, $01, $01, $02, $03, $04, $04, $04, $05, $01,
    $01, $01, $01, $01, $01, $02, $03, $04, $04, $04, $04, $01, $01, $01, $01, $01, $01, $02, $03,
    $04, $04, $04, $04, $05, $01, $01, $01, $01, $01, $02, $03, $04, $04, $04, $04, $04, $01, $01,
    $01, $01, $01, $02, $03, $04, $04, $04, $04, $04, $05, $01, $01, $01, $01, $02, $03, $04, $04,
    $04, $04, $04, $04, $01, $01, $01, $01, $02, $03, $04, $04, $04, $04, $04, $04, $05, $01, $01,
    $01, $02, $03, $04, $04, $04, $04, $04, $04, $04, $01, $01, $01, $02, $03, $04, $04, $04, $04,
    $04, $04, $04, $05, $01, $01, $02, $03, $04, $04, $04, $04, $04, $04, $04, $04, $01, $01, $02,
    $03, $04, $04, $04, $04, $04, $04, $04, $04, $05, $01, $02, $03, $04, $04, $04, $04, $04, $04,
    $04, $04, $04, $04, $02, $03, $04, $04, $04, $04, $04, $04, $04, $04, $04, $04, $06, $00, $00,
    $00, $00, $00, $00, $02, $06, $08, $08, $0A, $0C, $0C, $0E, $0E, $10, $12, $14, $16, $18, $1A,
    $1C, $1E, $20, $22, $24, $26, $28, $2A, $2C, $2E, $30, $32, $58, $5A, $5C, $5E, $60, $62, $64,
    $66, $68, $6A, $6C, $6E, $70, $72, $74, $76, $78, $7A, $7C, $7E, $7E, $7E, $80, $82, $86, $86,
    $8A, $8A, $8A, $8A, $8A, $8A);
  cram_bank2: array [0 .. 97] of byte = ($08, $09, $0A, $0B, $0C, $0D, $0E, $0F, $10, $11, $12, $13,
    $14, $15, $16, $17, $18, $19, $1A, $1B, $1C, $1D, $1E, $1F, $20, $21, $22, $23, $24, $25, $26,
    $27, $28, $29, $2A, $2B, $2C, $2D, $2E, $2F, $30, $31, $32, $33, $34, $35, $36, $37, $38, $39,
    $3A, $3B, $3C, $3D, $3E, $3F, $40, $41, $42, $43, $44, $45, $46, $47, $00, $00, $00, $00, $02,
    $02, $02, $02, $04, $04, $04, $04, $06, $06, $06, $06, $10, $10, $12, $12, $14, $14, $16, $20,
    $22, $16, $20, $22, $16, $16, $20, $20, $22, $22);
  crom_bank4_world0: array [0 .. 135] of byte = ($28, $00, $2C, $00, $30, $00, $34, $00, $38, $00,
    $3C, $00, $40, $00, $44, $00, $48, $00, $54, $00, $58, $00, $5C, $00, $60, $00, $68, $00, $70,
    $00, $74, $00, $78, $00, $7C, $00, $80, $00, $84, $00, $32, $00, $34, $00, $56, $00, $58, $00,
    $98, $00, $96, $00, $7A, $00, $7C, $00, $56, $00, $58, $00, $98, $00, $96, $00, $12, $01, $13,
    $01, $1C, $01, $1D, $01, $29, $01, $28, $01, $26, $01, $27, $01, $2A, $01, $2B, $01, $FA, $00,
    $FC, $00, $FE, $00, $00, $01, $02, $10, $00, $10, $D6, $00, $D8, $00, $D2, $00, $D4, $00, $DE,
    $00, $E0, $00, $DA, $00, $DC, $00, $F4, $00, $F2, $00, $36, $01, $37, $01, $38, $01, $39, $01,
    $3B, $01, $3A, $01, $34, $01, $35, $01, $C9, $02, $C8, $02);
  crom_bank4_world1: array [0 .. 103] of byte = ($24, $00, $28, $00, $2C, $00, $30, $00, $34, $00,
    $38, $00, $3C, $00, $42, $00, $48, $00, $4C, $00, $50, $00, $54, $00, $58, $00, $5A, $00, $5C,
    $00, $60, $00, $62, $00, $64, $00, $AA, $01, $AC, $01, $CE, $01, $D0, $01, $6E, $02, $70, $02,
    $62, $01, $64, $01, $86, $01, $88, $01, $6A, $02, $6C, $02, $02, $02, $04, $02, $06, $02, $08,
    $02, $0A, $02, $0C, $02, $82, $02, $84, $02, $0E, $02, $10, $02, $22, $02, $24, $02, $86, $02,
    $88, $02, $26, $02, $2E, $02, $8A, $02, $8C, $02, $28, $10, $28, $10, $8E, $02, $90, $02);
  crom_bank4_world2: array [0 .. 141] of byte = ($2A, $00, $32, $00, $3A, $00, $3E, $00, $46, $00,
    $4E, $00, $52, $00, $56, $00, $5A, $00, $5E, $00, $60, $00, $62, $00, $66, $00, $68, $00, $6A,
    $00, $6E, $00, $76, $00, $7E, $00, $82, $00, $86, $00, $8A, $00, $01, $03, $03, $03, $05, $03,
    $07, $03, $01, $03, $03, $03, $05, $03, $07, $03, $23, $03, $21, $03, $25, $03, $27, $03, $29,
    $03, $2B, $03, $25, $03, $27, $03, $29, $03, $2B, $03, $47, $03, $23, $03, $61, $03, $63, $03,
    $61, $03, $63, $03, $67, $03, $65, $03, $49, $03, $49, $03, $67, $03, $65, $03, $69, $03, $69,
    $03, $C9, $03, $C7, $03, $85, $03, $87, $03, $89, $03, $8B, $03, $85, $03, $87, $03, $89, $03,
    $8B, $03, $C9, $03, $C7, $03, $AB, $03, $AD, $03, $AF, $03, $C1, $03, $C5, $03, $C3, $03);
  crom_bank4_world3: array [0 .. 191] of byte = ($30, $00, $34, $00, $38, $00, $3C, $00, $40, $00,
    $44, $00, $48, $00, $4A, $00, $4C, $00, $50, $00, $54, $00, $58, $00, $5C, $00, $5E, $00, $60,
    $00, $64, $00, $68, $00, $6C, $00, $70, $00, $7A, $00, $84, $00, $88, $00, $A2, $00, $BC, $00,
    $51, $04, $53, $04, $51, $04, $53, $04, $51, $04, $51, $04, $55, $04, $57, $04, $55, $04, $57,
    $04, $55, $04, $55, $04, $59, $04, $59, $04, $59, $04, $9F, $04, $5D, $04, $5B, $04, $5D, $04,
    $5B, $04, $95, $04, $93, $04, $5F, $04, $5F, $04, $99, $04, $97, $04, $75, $04, $77, $04, $7F,
    $04, $91, $04, $9D, $04, $9B, $04, $B1, $04, $B3, $04, $B5, $04, $B7, $04, $B9, $04, $B1, $04,
    $B3, $04, $B5, $04, $B7, $04, $B9, $04, $BD, $04, $BB, $04, $D6, $04, $D7, $04, $D8, $04, $D9,
    $04, $DA, $04, $DB, $04, $DC, $04, $DD, $04, $DE, $04, $DF, $04, $E0, $04, $E1, $04, $E2, $04,
    $D6, $04, $D7, $04, $D8, $04, $D9, $04, $DA, $04, $DB, $04, $DC, $04, $DD, $04, $DE, $04, $DF,
    $04, $E0, $04, $E1, $04, $E2, $04, $12, $05, $11, $05);
  crom_bank4_world4: array [0 .. 181] of byte = ($24, $00, $24, $00, $34, $00, $38, $00, $38, $00,
    $60, $00, $64, $00, $64, $00, $7C, $00, $80, $00, $80, $00, $90, $00, $94, $00, $94, $00, $96,
    $00, $9A, $00, $9A, $00, $B2, $00, $56, $05, $57, $05, $58, $05, $59, $05, $5A, $05, $5B, $05,
    $5C, $05, $5D, $05, $87, $05, $86, $05, $5E, $05, $5F, $05, $60, $05, $61, $05, $62, $05, $63,
    $05, $5E, $05, $5F, $05, $60, $05, $61, $05, $62, $05, $63, $05, $64, $05, $65, $05, $66, $05,
    $67, $05, $66, $05, $65, $05, $64, $05, $63, $05, $85, $05, $84, $05, $68, $05, $69, $05, $6A,
    $05, $6B, $05, $6C, $05, $6D, $05, $6E, $05, $6F, $05, $70, $05, $71, $05, $72, $05, $6D, $05,
    $89, $05, $88, $05, $73, $05, $74, $05, $75, $05, $76, $05, $77, $05, $78, $05, $79, $05, $7A,
    $05, $8B, $05, $8A, $05, $7B, $05, $8C, $05, $8C, $05, $4A, $05, $4B, $05, $4C, $05, $4D, $05,
    $4E, $05, $4F, $05, $50, $05, $51, $05, $52, $05, $53, $05, $54, $05, $55, $05, $83, $05,
    $82, $05);
  crom_bank4_world5: array [0 .. 147] of byte = ($24, $00, $2C, $00, $34, $00, $38, $00, $40, $00,
    $48, $00, $4C, $00, $54, $00, $5C, $00, $60, $00, $64, $00, $68, $00, $6C, $00, $78, $00, $84,
    $00, $88, $00, $8C, $00, $90, $00, $43, $06, $45, $06, $47, $06, $49, $06, $43, $06, $45, $06,
    $47, $06, $49, $06, $65, $06, $63, $06, $6D, $06, $6F, $06, $71, $06, $83, $06, $6D, $06, $6F,
    $06, $71, $06, $83, $06, $6F, $06, $83, $06, $85, $06, $87, $06, $89, $06, $8B, $06, $85, $06,
    $87, $06, $89, $06, $8B, $06, $8F, $06, $8D, $06, $AD, $06, $AF, $06, $AD, $06, $AF, $06, $C3,
    $06, $B1, $06, $C5, $06, $C7, $06, $C9, $06, $CB, $06, $CD, $06, $CF, $06, $C5, $06, $C7, $06,
    $C9, $06, $CB, $06, $CD, $06, $CF, $06, $CB, $06, $C5, $06, $E3, $06, $D1, $06, $E3, $06, $D1,
    $06, $E5, $06, $E3, $06);
  crom_bank4_world6: array [0 .. 151] of byte = ($2A, $00, $32, $00, $3A, $00, $3E, $00, $46, $00,
    $4E, $00, $52, $00, $5A, $00, $62, $00, $66, $00, $6A, $00, $6E, $00, $72, $00, $76, $00, $7A,
    $00, $7E, $00, $82, $00, $86, $00, $8A, $00, $8E, $00, $92, $00, $5B, $08, $5D, $08, $5F, $08,
    $61, $08, $5B, $08, $5D, $08, $5F, $08, $61, $08, $65, $08, $63, $08, $67, $08, $69, $08, $7B,
    $08, $7D, $08, $67, $08, $69, $08, $7B, $08, $7D, $08, $81, $08, $7F, $08, $83, $08, $85, $08,
    $87, $08, $89, $08, $83, $08, $85, $08, $87, $08, $89, $08, $9D, $08, $9B, $08, $9F, $08, $A1,
    $08, $9F, $08, $A1, $08, $A5, $08, $A3, $08, $A7, $08, $A9, $08, $A7, $08, $A9, $08, $BD, $08,
    $BB, $08, $BF, $08, $C1, $08, $BF, $08, $C1, $08, $C5, $08, $C3, $08, $DD, $08, $DF, $08, $DD,
    $08, $DF, $08, $E1, $08, $C7, $08, $C7, $08);
  crom_bank4_world7: array [0 .. 137] of byte = ($2A, $00, $32, $00, $3A, $00, $3E, $00, $42, $00,
    $46, $00, $4A, $00, $4E, $00, $52, $00, $56, $00, $5E, $00, $66, $00, $6A, $00, $6E, $00, $72,
    $00, $76, $00, $78, $00, $7A, $00, $7E, $00, $82, $00, $86, $00, $A1, $05, $A3, $05, $A5, $05,
    $A7, $05, $A9, $05, $AB, $05, $AD, $05, $AF, $05, $C1, $05, $C3, $05, $C5, $05, $C7, $05, $C5,
    $05, $C7, $05, $E3, $05, $E5, $05, $E7, $05, $E9, $05, $ED, $05, $EF, $05, $03, $06, $05, $06,
    $58, $10, $5A, $10, $5C, $10, $5E, $10, $58, $10, $5A, $10, $5C, $10, $5E, $10, $62, $10, $64,
    $10, $25, $06, $27, $06, $25, $06, $27, $06, $29, $06, $2B, $06, $2F, $06, $2F, $06, $2D, $06,
    $2F, $06, $9C, $05, $9D, $05, $9C, $05, $9D, $05, $78, $10, $9D, $05);
  crom_bank4_world8: array [0 .. 157] of byte = ($30, $00, $34, $00, $38, $00, $3C, $00, $3E, $00,
    $40, $00, $42, $00, $46, $00, $4A, $00, $4E, $00, $5C, $00, $6A, $00, $6E, $00, $70, $00, $72,
    $00, $76, $00, $7A, $00, $7E, $00, $82, $00, $88, $00, $8E, $00, $92, $00, $96, $00, $9A, $00,
    $B0, $09, $B2, $09, $B0, $09, $B2, $09, $B4, $09, $B0, $09, $B6, $09, $B6, $09, $B6, $09, $B8,
    $09, $BA, $09, $B8, $09, $BA, $09, $BC, $09, $B8, $09, $BE, $09, $D0, $09, $D2, $09, $D4, $09,
    $D6, $09, $D8, $09, $DA, $09, $BE, $09, $D0, $09, $D2, $09, $D4, $09, $D6, $09, $D8, $09, $DA,
    $09, $DC, $09, $D4, $09, $DE, $09, $DE, $09, $F4, $09, $DE, $09, $F6, $09, $F8, $09, $F6, $09,
    $F8, $09, $1A, $0A, $F6, $09, $1C, $0A, $1E, $0A, $30, $0A, $1C, $0A, $1E, $0A, $30, $0A, $32,
    $0A, $1C, $0A, $34, $0A, $36, $0A, $34, $0A, $36, $0A, $38, $0A, $36, $0A);
  crom_bank4_world9: array [0 .. 223] of byte = ($30, $00, $34, $00, $38, $00, $40, $00, $48, $00,
    $50, $00, $58, $00, $60, $00, $68, $00, $70, $00, $78, $00, $80, $00, $88, $00, $90, $00, $98,
    $00, $A0, $00, $A6, $00, $AC, $00, $B4, $00, $BC, $00, $C4, $00, $CC, $00, $D0, $00, $D4, $00,
    $AF, $0B, $B1, $0B, $AF, $0B, $B1, $0B, $B3, $0B, $B5, $0B, $EF, $0F, $F0, $0F, $B7, $0B, $B9,
    $0B, $BB, $0B, $BD, $0B, $B7, $0B, $B9, $0B, $BB, $0B, $BD, $0B, $CF, $0B, $D1, $0B, $F1, $0F,
    $F2, $0F, $47, $11, $49, $11, $4B, $11, $4D, $11, $47, $11, $49, $11, $4B, $11, $4D, $11, $4F,
    $11, $51, $11, $FD, $0F, $FE, $0F, $EF, $0B, $F1, $0B, $F3, $0B, $F5, $0B, $EF, $0B, $F1, $0B,
    $F3, $0B, $F5, $0B, $F7, $0B, $F9, $0B, $F3, $0F, $F4, $0F, $FB, $0B, $FD, $0B, $0F, $0C, $11,
    $0C, $FB, $0B, $FD, $0B, $0F, $0C, $11, $0C, $13, $0C, $15, $0C, $F5, $0F, $F6, $0F, $6B, $11,
    $6D, $11, $6F, $11, $6B, $11, $6D, $11, $6F, $11, $1D, $0C, $2F, $0C, $F7, $0F, $F8, $0F, $31,
    $0C, $33, $0C, $35, $0C, $37, $0C, $31, $0C, $33, $0C, $35, $0C, $37, $0C, $39, $0C, $3B, $0C,
    $F9, $0F, $FA, $0F, $3D, $0C, $4F, $0C, $3D, $0C, $4F, $0C, $51, $0C, $53, $0C, $FB, $0F, $FC,
    $0F, $DC, $02, $DD, $02);
  crom_bank5_world0: array [0 .. 203] of byte = ($1C, $00, $1C, $00, $32, $00, $32, $00, $48, $00,
    $48, $00, $B6, $00, $5E, $00, $A0, $00, $A0, $00, $74, $00, $74, $00, $8A, $00, $8A, $00, $01,
    $08, $C4, $19, $49, $08, $C4, $19, $85, $08, $C7, $18, $C3, $5A, $B7, $6E, $D0, $02, $00, $01,
    $FF, $FF, $C9, $08, $D3, $19, $09, $09, $C4, $19, $45, $09, $C7, $18, $C3, $5A, $B7, $6E, $F0,
    $00, $00, $01, $FF, $FF, $80, $09, $C5, $19, $C8, $09, $C3, $19, $04, $0A, $C7, $18, $C3, $5A,
    $B7, $6E, $D0, $02, $00, $01, $FF, $FF, $41, $0A, $C7, $29, $89, $0A, $C7, $29, $C5, $0A, $C7,
    $18, $C3, $5A, $B7, $6E, $D0, $02, $00, $01, $FF, $FF, $01, $0B, $45, $29, $49, $0B, $43, $29,
    $85, $0B, $C7, $18, $C3, $5A, $B7, $6E, $D0, $02, $00, $01, $FF, $FF, $49, $0B, $47, $29, $49,
    $0B, $47, $29, $85, $0B, $C7, $18, $C3, $5A, $B7, $6E, $D0, $02, $00, $01, $FF, $FF, $C0, $0B,
    $C1, $18, $08, $0C, $C1, $18, $44, $0C, $C7, $18, $C3, $5A, $B7, $6E, $D0, $02, $00, $01, $FF,
    $FF, $80, $04, $C0, $39, $80, $0C, $C3, $39, $C4, $0C, $C7, $18, $C3, $5A, $B7, $6E, $3C, $00,
    $00, $01, $FF, $FF);
  crom_bank5_world1: array [0 .. 143] of byte = ($0C, $00, $22, $00, $38, $00, $4E, $00, $64, $00,
    $7A, $00, $01, $08, $C4, $19, $49, $08, $C4, $19, $84, $08, $C7, $18, $E6, $5A, $BF, $6E, $58,
    $02, $00, $01, $FF, $FF, $C1, $08, $C4, $19, $09, $09, $C4, $19, $44, $09, $C7, $18, $EB, $5A,
    $C1, $6E, $58, $02, $00, $01, $FF, $FF, $41, $0A, $45, $1A, $89, $0A, $43, $1A, $C4, $0A, $C7,
    $18, $C3, $5A, $B7, $6E, $58, $02, $00, $01, $FF, $FF, $81, $11, $C1, $29, $C9, $11, $C1, $29,
    $04, $0A, $C7, $18, $C3, $5A, $B7, $6E, $58, $02, $00, $01, $FF, $FF, $01, $03, $C0, $19, $49,
    $03, $C0, $19, $84, $0B, $C7, $18, $C3, $5A, $B7, $6E, $58, $02, $00, $01, $FF, $FF, $C9, $03,
    $C0, $39, $09, $04, $C0, $39, $44, $0C, $C7, $18, $C3, $5A, $B7, $6E, $58, $02, $00, $01,
    $FF, $FF);
  crom_bank5_world2: array [0 .. 167] of byte = ($0E, $00, $24, $00, $3A, $00, $50, $00, $66, $00,
    $7C, $00, $92, $00, $01, $18, $C7, $39, $49, $18, $C5, $39, $84, $08, $C7, $18, $C3, $5A, $B7,
    $6E, $E0, $01, $00, $01, $FF, $FF, $C1, $08, $C7, $39, $09, $09, $C5, $39, $44, $09, $C7, $18,
    $C3, $5A, $B7, $6E, $E0, $01, $00, $01, $FF, $FF, $81, $09, $47, $49, $C9, $09, $45, $49, $04,
    $0A, $C7, $18, $C3, $5A, $B7, $6E, $E0, $01, $00, $01, $FF, $FF, $41, $02, $C7, $49, $89, $02,
    $C5, $49, $C4, $0A, $C7, $18, $C3, $5A, $B7, $6E, $E0, $01, $00, $01, $FF, $FF, $01, $03, $43,
    $29, $49, $03, $42, $29, $84, $0B, $C7, $18, $C3, $5A, $B7, $6E, $E0, $01, $00, $01, $FF, $FF,
    $C1, $1B, $43, $29, $09, $1C, $42, $29, $44, $0C, $C7, $18, $C3, $5A, $B7, $6E, $E0, $01, $00,
    $01, $FF, $FF, $81, $0C, $43, $39, $C9, $0C, $41, $39, $04, $0D, $C7, $18, $C3, $5A, $B7, $6E,
    $E0, $01, $00, $01, $FF, $FF);
  crom_bank5_world3: array [0 .. 191] of byte = ($10, $00, $26, $00, $3C, $00, $52, $00, $68, $00,
    $7E, $00, $94, $00, $AA, $00, $01, $08, $C1, $39, $49, $08, $C1, $39, $84, $08, $C7, $18, $C3,
    $5A, $B7, $6E, $68, $01, $00, $01, $FF, $FF, $C1, $08, $C1, $39, $09, $09, $C1, $39, $44, $09,
    $C7, $18, $C3, $5A, $B7, $6E, $68, $01, $00, $01, $FF, $FF, $81, $01, $40, $39, $C9, $01, $40,
    $39, $04, $0A, $C7, $18, $C3, $5A, $B7, $6E, $68, $01, $00, $01, $FF, $FF, $41, $0A, $C3, $39,
    $89, $0A, $C3, $39, $C4, $0A, $C7, $18, $C3, $5A, $B7, $6E, $68, $01, $00, $01, $FF, $FF, $01,
    $03, $40, $19, $49, $03, $40, $19, $84, $0B, $C7, $18, $C3, $5A, $B7, $6E, $68, $01, $00, $01,
    $FF, $FF, $C1, $0B, $D3, $49, $09, $0C, $C9, $49, $44, $0C, $C7, $18, $C3, $5A, $B7, $6E, $78,
    $00, $00, $01, $FF, $FF, $81, $24, $C7, $1B, $C9, $24, $C7, $1B, $04, $0D, $C7, $18, $C3, $5A,
    $B7, $6E, $68, $01, $00, $01, $FF, $FF, $40, $65, $41, $29, $88, $65, $40, $29, $C4, $0D, $C7,
    $18, $C3, $5A, $B7, $6E, $68, $01, $00, $01, $FF, $FF);
  crom_bank5_world4: array [0 .. 143] of byte = ($0C, $00, $22, $00, $38, $00, $4E, $00, $64, $00,
    $7A, $00, $00, $38, $C6, $18, $48, $38, $C6, $18, $84, $08, $C7, $18, $C3, $5A, $B7, $6E, $68,
    $01, $00, $01, $FF, $FF, $C0, $98, $C9, $18, $08, $99, $C9, $18, $44, $09, $C7, $18, $C3, $5A,
    $B7, $6E, $68, $01, $00, $01, $FF, $FF, $80, $59, $C9, $18, $C8, $59, $C9, $18, $04, $0A, $C7,
    $18, $C3, $5A, $B7, $6E, $68, $01, $00, $01, $FF, $FF, $40, $3A, $C4, $18, $88, $3A, $C4, $18,
    $C4, $0A, $C7, $18, $C3, $5A, $B7, $6E, $68, $01, $00, $01, $FF, $FF, $00, $03, $80, $18, $48,
    $03, $80, $18, $84, $0B, $C7, $18, $C3, $5A, $B7, $6E, $68, $01, $00, $01, $FF, $FF, $C0, $5B,
    $85, $31, $08, $5C, $85, $31, $44, $0C, $C7, $18, $C3, $5A, $B7, $6E, $68, $01, $00, $01,
    $FF, $FF);
  crom_bank5_world5: array [0 .. 143] of byte = ($0C, $00, $22, $00, $38, $00, $4E, $00, $64, $00,
    $7A, $00, $01, $18, $43, $39, $49, $18, $43, $39, $85, $08, $C7, $18, $C3, $5A, $B7, $6E, $68,
    $01, $00, $01, $FF, $FF, $C1, $18, $C3, $39, $09, $19, $C3, $39, $45, $09, $C3, $18, $C3, $5A,
    $B7, $6E, $68, $01, $00, $01, $FF, $FF, $81, $19, $43, $39, $C9, $19, $43, $39, $05, $0A, $C7,
    $18, $C3, $5A, $B7, $6E, $68, $01, $00, $01, $FF, $FF, $41, $0A, $43, $19, $89, $0A, $43, $19,
    $C5, $0A, $47, $19, $C3, $5A, $B7, $6E, $68, $01, $00, $00, $FF, $FF, $01, $2B, $C3, $19, $49,
    $2B, $C2, $19, $85, $0B, $C7, $18, $C3, $5A, $B7, $6E, $68, $01, $00, $01, $FF, $FF, $C1, $0B,
    $C3, $18, $09, $0C, $C3, $18, $45, $0C, $C7, $18, $C3, $5A, $B7, $6E, $68, $01, $00, $01,
    $FF, $FF);
  crom_bank5_world6: array [0 .. 167] of byte = ($0E, $00, $24, $00, $3A, $00, $50, $00, $66, $00,
    $7C, $00, $92, $00, $01, $18, $45, $39, $49, $18, $43, $39, $85, $08, $C7, $18, $C3, $5A, $B7,
    $6E, $68, $01, $00, $01, $FF, $FF, $C1, $18, $45, $39, $09, $19, $43, $39, $45, $09, $C7, $18,
    $C3, $5A, $B7, $6E, $68, $01, $00, $01, $FF, $FF, $81, $19, $45, $39, $C9, $19, $43, $39, $05,
    $0A, $C7, $18, $C3, $5A, $B7, $6E, $68, $01, $00, $01, $FF, $FF, $41, $0A, $C7, $39, $89, $0A,
    $C5, $39, $C5, $0A, $C7, $18, $C3, $5A, $B7, $6E, $68, $01, $00, $00, $FF, $FF, $01, $0B, $05,
    $42, $49, $0B, $03, $42, $85, $0B, $C7, $18, $C3, $5A, $B7, $6E, $68, $01, $00, $01, $FF, $FF,
    $C1, $0B, $C5, $39, $09, $0C, $C3, $39, $45, $0C, $C7, $18, $C3, $5A, $B7, $6E, $68, $01, $00,
    $01, $FF, $FF, $81, $0C, $4D, $0A, $C9, $0C, $4B, $0A, $05, $0D, $C7, $18, $C3, $5A, $B7, $6E,
    $68, $01, $00, $01, $FF, $FF);
  crom_bank5_world7: array [0 .. 167] of byte = ($0E, $00, $24, $00, $3A, $00, $50, $00, $66, $00,
    $7C, $00, $92, $00, $01, $18, $C5, $41, $49, $18, $C3, $41, $85, $08, $C7, $18, $C3, $5A, $B7,
    $6E, $E0, $01, $00, $01, $FF, $FF, $C1, $08, $C5, $41, $09, $09, $C3, $41, $45, $09, $C7, $18,
    $C3, $5A, $B7, $6E, $E0, $01, $00, $01, $FF, $FF, $81, $09, $45, $4A, $C9, $09, $43, $4A, $05,
    $0A, $C7, $18, $C3, $5A, $B7, $6E, $E0, $01, $00, $01, $FF, $FF, $41, $1A, $C5, $39, $81, $1A,
    $C3, $39, $C5, $0A, $C7, $18, $C3, $5A, $B7, $6E, $E0, $01, $00, $00, $FF, $FF, $01, $0B, $45,
    $5A, $49, $0B, $43, $5A, $85, $0B, $C7, $18, $C3, $5A, $B7, $6E, $E0, $01, $00, $01, $FF, $FF,
    $C1, $03, $C5, $59, $09, $04, $C3, $59, $45, $0C, $C7, $18, $C3, $5A, $B7, $6E, $E0, $01, $00,
    $01, $FF, $FF, $80, $0C, $45, $29, $C8, $0C, $43, $29, $04, $0D, $C7, $18, $C3, $5A, $B7, $6E,
    $E0, $01, $00, $01, $FF, $FF);
  crom_bank5_world8: array [0 .. 191] of byte = ($10, $00, $26, $00, $3C, $00, $52, $00, $68, $00,
    $7E, $00, $94, $00, $AA, $00, $01, $08, $43, $49, $49, $08, $43, $49, $85, $08, $C7, $18, $C3,
    $5A, $B7, $6E, $68, $01, $00, $01, $FF, $FF, $C1, $00, $43, $39, $09, $01, $43, $49, $45, $01,
    $C7, $18, $C3, $5A, $B7, $6E, $68, $01, $00, $01, $FF, $FF, $81, $09, $C3, $59, $C9, $09, $C3,
    $59, $05, $0A, $C7, $18, $C3, $5A, $B7, $6E, $68, $01, $00, $01, $FF, $FF, $41, $32, $C3, $5B,
    $89, $32, $C3, $5B, $C5, $0A, $C7, $18, $C3, $5A, $B7, $6E, $68, $01, $00, $00, $FF, $FF, $01,
    $03, $C3, $49, $49, $03, $C3, $49, $85, $0B, $C7, $18, $C3, $5A, $B7, $6E, $68, $01, $00, $01,
    $FF, $FF, $C1, $0B, $C3, $19, $09, $0C, $C3, $19, $45, $0C, $C7, $18, $C3, $5A, $B7, $6E, $68,
    $01, $00, $01, $FF, $FF, $81, $14, $C5, $39, $C9, $14, $C3, $39, $05, $0D, $C7, $18, $C3, $5A,
    $B7, $6E, $68, $01, $00, $01, $FF, $FF, $41, $0D, $C7, $39, $89, $0D, $C5, $39, $C5, $0D, $C7,
    $18, $C3, $5A, $B7, $6E, $68, $01, $00, $01, $FF, $FF);
  crom_bank5_world9: array [0 .. 191] of byte = ($10, $00, $26, $00, $3C, $00, $52, $00, $68, $00,
    $7E, $00, $94, $00, $AA, $00, $01, $08, $03, $1A, $49, $08, $03, $1A, $85, $08, $C7, $18, $C3,
    $5A, $B7, $6E, $00, $05, $00, $01, $FF, $FF, $C1, $18, $C3, $18, $09, $19, $03, $1A, $45, $09,
    $C7, $18, $C3, $5A, $B7, $6E, $00, $05, $00, $01, $FF, $FF, $81, $19, $45, $39, $C9, $19, $43,
    $39, $05, $0A, $C7, $18, $C3, $5A, $B7, $6E, $00, $05, $00, $01, $FF, $FF, $41, $1A, $45, $18,
    $89, $1A, $43, $18, $C5, $0A, $C7, $18, $C3, $5A, $B7, $6E, $00, $05, $00, $00, $FF, $FF, $01,
    $1B, $C5, $18, $49, $1B, $C3, $18, $85, $0B, $C7, $18, $C3, $5A, $B7, $6E, $00, $05, $00, $01,
    $FF, $FF, $C1, $13, $47, $39, $09, $14, $45, $39, $45, $0C, $C7, $18, $C3, $5A, $B7, $6E, $00,
    $05, $00, $01, $FF, $FF, $81, $1C, $45, $19, $C9, $1C, $43, $19, $05, $0D, $C7, $18, $C3, $5A,
    $B7, $6E, $00, $05, $00, $01, $FF, $FF, $41, $0D, $C5, $18, $89, $0D, $C3, $18, $C5, $0D, $C7,
    $18, $C3, $5A, $B7, $6E, $00, $05, $00, $01, $FF, $FF);
  cram_bank6: array [0 .. 319] of byte = ($05, $01, $00, $00, $00, $00, $00, $00, $11, $00, $00,
    $04, $82, $00, $00, $00, $00, $00, $00, $21, $30, $05, $00, $00, $00, $00, $42, $00, $00, $33,
    $04, $00, $54, $40, $00, $00, $00, $00, $00, $00, $50, $40, $03, $00, $00, $00, $00, $00, $00,
    $04, $24, $00, $00, $00, $00, $00, $22, $22, $22, $00, $00, $00, $00, $00, $03, $33, $03, $00,
    $00, $00, $00, $00, $33, $20, $23, $00, $00, $00, $00, $00, $30, $00, $33, $01, $00, $00, $00,
    $00, $22, $22, $22, $02, $00, $00, $00, $00, $00, $34, $00, $40, $00, $00, $00, $00, $23, $02,
    $03, $40, $00, $00, $00, $00, $22, $00, $12, $04, $00, $00, $00, $00, $02, $22, $02, $04, $00,
    $00, $00, $00, $44, $03, $00, $00, $00, $00, $00, $00, $30, $44, $00, $00, $00, $00, $00, $00,
    $00, $30, $53, $00, $00, $00, $00, $00, $02, $22, $32, $00, $00, $00, $00, $00, $04, $40, $20,
    $00, $00, $00, $00, $00, $22, $02, $02, $00, $00, $00, $00, $00, $20, $30, $30, $00, $00, $00,
    $00, $00, $12, $21, $22, $00, $00, $00, $00, $00, $22, $20, $02, $00, $00, $00, $00, $00, $22,
    $02, $02, $02, $00, $00, $00, $00, $02, $22, $20, $03, $00, $00, $00, $00, $12, $12, $11, $02,
    $00, $00, $00, $00, $03, $21, $00, $03, $00, $00, $00, $00, $12, $30, $03, $00, $00, $00, $00,
    $00, $20, $01, $22, $03, $00, $00, $00, $00, $12, $21, $22, $03, $00, $00, $00, $00, $02, $02,
    $20, $00, $00, $00, $00, $00, $10, $22, $22, $00, $00, $00, $00, $00, $02, $10, $00, $31, $00,
    $00, $00, $00, $21, $01, $01, $11, $00, $00, $00, $00, $20, $03, $02, $02, $00, $00, $00, $00,
    $33, $20, $00, $10, $00, $00, $00, $00, $02, $20, $12, $00, $00, $00, $00, $00, $30, $00, $02,
    $11, $00, $00, $00, $00);
  cram_bank6_extra: array [0 .. 319] of byte = ($05, $01, $00, $00, $00, $00, $00, $00, $42, $00,
    $00, $30, $00, $00, $00, $00, $13, $00, $00, $04, $00, $00, $00, $00, $00, $00, $30, $60, $00,
    $00, $00, $00, $05, $40, $04, $00, $00, $00, $00, $00, $35, $00, $03, $00, $00, $00, $00, $00,
    $12, $02, $00, $06, $00, $00, $00, $00, $22, $21, $02, $03, $00, $00, $00, $00, $00, $03, $30,
    $03, $00, $00, $00, $00, $00, $33, $30, $03, $00, $00, $00, $00, $00, $33, $34, $00, $00, $00,
    $00, $00, $02, $24, $22, $02, $00, $00, $00, $00, $44, $30, $00, $00, $00, $00, $00, $00, $24,
    $05, $03, $00, $00, $00, $00, $00, $00, $00, $80, $00, $00, $00, $00, $00, $00, $00, $06, $00,
    $00, $00, $00, $00, $00, $00, $40, $01, $50, $00, $04, $00, $02, $00, $02, $01, $50, $00, $04,
    $00, $08, $00, $00, $30, $00, $00, $00, $00, $05, $00, $40, $21, $50, $00, $00, $00, $10, $00,
    $04, $02, $00, $00, $00, $00, $22, $02, $20, $00, $00, $00, $00, $00, $00, $00, $24, $03, $00,
    $00, $00, $00, $21, $02, $12, $02, $00, $00, $00, $00, $22, $02, $02, $00, $00, $00, $00, $00,
    $22, $02, $44, $00, $00, $00, $00, $00, $02, $20, $52, $00, $00, $00, $00, $00, $11, $12, $65,
    $00, $00, $00, $00, $00, $02, $00, $12, $00, $00, $00, $00, $00, $02, $31, $03, $00, $00, $00,
    $00, $00, $20, $32, $10, $00, $00, $00, $00, $00, $22, $31, $12, $00, $00, $00, $00, $00, $10,
    $02, $20, $00, $00, $00, $00, $00, $31, $22, $02, $00, $00, $00, $00, $00, $00, $06, $00, $00,
    $00, $00, $00, $00, $00, $00, $08, $00, $00, $00, $00, $00, $20, $03, $02, $02, $00, $00, $00,
    $00, $33, $20, $00, $10, $00, $00, $00, $00, $02, $20, $12, $00, $00, $00, $00, $00, $30, $00,
    $02, $11, $00, $00, $00, $00);
  crom_bank7_world0: array [0 .. 13] of byte = ($03, $03, $03, $03, $0C, $0C, $0A, $07, $0A, $0A,
    $08, $08, $08, $08);
  crom_bank7_world1: array [0 .. 5] of byte = ($03, $05, $01, $02, $04, $04);
  crom_bank7_world2: array [0 .. 6] of byte = ($03, $05, $07, $07, $08, $08, $01);
  crom_bank7_world3: array [0 .. 7] of byte = ($07, $07, $07, $08, $05, $08, $07, $0B);
  crom_bank7_world4: array [0 .. 5] of byte = ($0A, $0B, $0A, $0A, $10, $10);
  crom_bank7_world5: array [0 .. 5] of byte = ($05, $08, $04, $08, $08, $07);
  crom_bank7_world6: array [0 .. 6] of byte = ($04, $07, $05, $08, $06, $08, $03);
  crom_bank7_world7: array [0 .. 6] of byte = ($07, $06, $06, $05, $08, $07, $0A);
  crom_bank7_world8: array [0 .. 7] of byte = ($06, $05, $01, $08, $05, $05, $06, $08);
  crom_bank7_world9: array [0 .. 7] of byte = ($01, $02, $03, $04, $05, $06, $07, $08);
  cchip_round_address: array [0 .. 49] of dword = ($030000, $030360, $030798, $030CA8, $0311B8,
    $0315F0, $031B00, $0321C0, $032880, $032E68, $033600, $033D98, $0347B8, $034E78, $035610,
    $035E80, $0368A0, $037038, $037620, $037A58, $038118, $038700, $038CE8, $0393A8, $039A68,
    $03A2D8, $03AC20, $03B568, $03BF88, $03C648, $03CDE0, $03D650, $03DEC0, $03E658, $03EEC8,
    $03F738, $040080, $0408F0, $041238, $041B80, $0425A0, $042678, $042750, $042828, $042900,
    $0429D8, $042AB0, $042B88, $042C60, $042D38);
  cchip_round_height: array [0 .. 49] of word = ($02DC, $03B4, $0444, $04BC, $03B4, $0444, $05DC,
    $050C, $0594, $06B4, $06B4, $0894, $065C, $06CC, $07BC, $08BC, $0704, $059C, $030C, $0504,
    $0504, $0564, $05CC, $0644, $080C, $086C, $08E4, $0954, $065C, $06D4, $0754, $07C4, $06D4,
    $0754, $0824, $0884, $080C, $086C, $08E4, $096C, $0999, $0999, $0999, $0999, $0999, $0999,
    $0999, $0999, $0999, $0999);
  cchip_extra_patch: array [0 .. 9, 0 .. 7] of word = (($0168, $0078, $0168, $0168, $0168, $02D0,
    $0168, $003C), ($0258, $0258, $0258, $0258, $0258, $0258, $0000, $0000),
    ($01E0, $01E0, $01E0, $01E0, $01E0, $01E0, $01E0, $0000), ($0168, $0168, $0168, $0168, $0168,
    $001E, $0168, $0168), ($0168, $0168, $0168, $0168, $0168, $0168, $0000, $0000),
    ($0168, $0168, $0168, $0168, $0168, $0168, $0000, $0000), ($0168, $0168, $0168, $0168, $0168,
    $0168, $0168, $0000), ($01E0, $01E0, $01E0, $01E0, $01E0, $01E0, $01E0, $0000),
    ($01A4, $01A4, $01A4, $01A4, $01A4, $01A4, $01A4, $01A4), ($0500, $0500, $0500, $0500, $0500,
    $0500, $0500, $0500));
  cchip_goalin: array [0 .. 14, 0 .. 5] of byte = (($00, $00, $28, $28, $50, $50),
    ($00, $00, $00, $00, $50, $50), ($00, $10, $20, $30, $00, $10), ($00, $10, $20, $30, $40, $50),
    ($00, $18, $30, $00, $18, $30), ($00, $18, $30, $30, $18, $00), ($00, $28, $50, $00, $28, $50),
    ($00, $30, $20, $50, $10, $20), ($00, $50, $00, $50, $00, $50), ($30, $18, $00, $30, $18, $00),
    ($30, $18, $00, $00, $18, $30), ($30, $00, $10, $40, $50, $20), ($30, $20, $10, $00, $10, $00),
    ($50, $40, $30, $20, $10, $00), ($50, $50, $50, $50, $00, $00));

type
  world_data = record
    data: pbyte;
    size: word;
  end;

var
  cram: array [0 .. 7, 0 .. $400] of byte;
  current_bank, extra_version: byte;
  crom_bank4, crom_bank5, crom_bank7: array [0 .. 9] of world_data;

procedure rbisland_init_cchip(num, extra: byte);
function rbisland_cchip_ram_r(direccion: word): word;
function rbisland_cchip_ctrl_r: word;
procedure rbisland_cchip_ctrl_w;
procedure rbisland_cchip_bank_w(data: word);
procedure rbisland_cchip_ram_w(direccion, data: word);
procedure rbisland_timer;

implementation

procedure request_round_data;
var
  round: byte;
begin
  round := cram[1, $141]; // 0...49 */
  copymemory(@cram[1, 0], @cram_bank1[0], 321);
  copymemory(@cram[2, 0], @cram_bank2[0], 98);
  cram[1, 1] := cchip_round_height[round] shr 0;
  cram[1, 2] := cchip_round_height[round] shr 8;
  cram[1, $142] := cchip_round_address[round] shr 24;
  cram[1, $143] := cchip_round_address[round] shr 16;
  cram[1, $144] := cchip_round_address[round] shr 8;
  cram[1, $145] := cchip_round_address[round] shr 0;
  // set the secret room or boss flag */
  cram[1, $148] := byte((round >= 40) or ((round mod 4) = 3));
end;

procedure request_world_data;
const
  world_swap: array [0 .. 9] of byte = (8, 7, 6, 4, 0, 2, 3, 5, 1, 9);
var
  world, i: byte;
  patch: word;
begin
  world := cram[0, $00D] div 4; // 0...9
  // the extra version has the world data swapped around
  if (extra_version <> 0) then
    world := world_swap[world];
  // first two bytes in each bank are left unchanged
  copymemory(@cram[4, 2], crom_bank4[world].data, crom_bank4[world].size);
  copymemory(@cram[5, 2], crom_bank5[world].data, crom_bank5[world].size);
  copymemory(@cram[7, 2], crom_bank7[world].data, crom_bank7[world].size);
  // banks 5 and 6 are different in the extra version
  if (extra_version <> 0) then
  begin
    for i := 0 to 7 do
    begin
      patch := cchip_extra_patch[world, i];
      if (patch <> 0) then
      begin
        cram[5, cram[5, 2] + 22 * i + 18] := patch shr 0;
        cram[5, cram[5, 2] + 22 * i + 19] := patch shr 8;
      end;
    end;
    copymemory(@cram[6, 2], @cram_bank6_extra[0], 320);
  end
  else
  begin
    copymemory(@cram[6, 2], @cram_bank6[0], 320);
  end;
end;

procedure request_goalin_data;
var
  n: byte;
begin
  n := random(15);
  // x coordinates */
  cram[1, $14B] := $00;
  cram[1, $14D] := $10;
  cram[1, $14F] := $20;
  cram[1, $151] := $38;
  cram[1, $153] := $50;
  cram[1, $155] := $60;
  // y coordinates */
  cram[1, $14A] := cchip_goalin[n, 0];
  cram[1, $14C] := cchip_goalin[n, 1];
  cram[1, $14E] := cchip_goalin[n, 2];
  cram[1, $150] := cchip_goalin[n, 3];
  cram[1, $152] := cchip_goalin[n, 4];
  cram[1, $154] := cchip_goalin[n, 5];
end;

procedure rbisland_timer;
begin
  if (cram[1, $100] = 1) then
  begin
    request_round_data;
    cram[1, $100] := $FF;
  end;
  if (cram[5, $000] = 1) then
  begin
    request_world_data;
    cram[5, $000] := $FF;
  end;
  if (cram[1, $149] = 1) then
  begin
    request_goalin_data;
    cram[1, $149] := $FF;
  end;
  cram[0, 3] := marcade.in0; // 800007 STARTn + SERVICE1
  cram[0, 4] := marcade.in1; // 800009 COINn
  cram[0, 5] := marcade.in2; // 80000B Player controls + TILT
  cram[0, 6] := $7F; // 80000D Player controls (cocktail)
end;

procedure rbisland_init_cchip(num, extra: byte);
begin
  timers.init(num, 8000000 / 60, rbisland_timer, nil, true);
  extra_version := extra;
  // bank4
  crom_bank4[0].data := @crom_bank4_world0[0];
  crom_bank4[0].size := 136;
  crom_bank4[1].data := @crom_bank4_world1[0];
  crom_bank4[1].size := 104;
  crom_bank4[2].data := @crom_bank4_world2[0];
  crom_bank4[2].size := 142;
  crom_bank4[3].data := @crom_bank4_world3[0];
  crom_bank4[3].size := 192;
  crom_bank4[4].data := @crom_bank4_world4[0];
  crom_bank4[4].size := 182;
  crom_bank4[5].data := @crom_bank4_world5[0];
  crom_bank4[5].size := 148;
  crom_bank4[6].data := @crom_bank4_world6[0];
  crom_bank4[6].size := 152;
  crom_bank4[7].data := @crom_bank4_world7[0];
  crom_bank4[7].size := 138;
  crom_bank4[8].data := @crom_bank4_world8[0];
  crom_bank4[8].size := 158;
  crom_bank4[9].data := @crom_bank4_world9[0];
  crom_bank4[9].size := 224;
  // bank5
  crom_bank5[0].data := @crom_bank5_world0[0];
  crom_bank5[0].size := 204;
  crom_bank5[1].data := @crom_bank5_world1[0];
  crom_bank5[1].size := 144;
  crom_bank5[2].data := @crom_bank5_world2[0];
  crom_bank5[2].size := 168;
  crom_bank5[3].data := @crom_bank5_world3[0];
  crom_bank5[3].size := 192;
  crom_bank5[4].data := @crom_bank5_world4[0];
  crom_bank5[4].size := 144;
  crom_bank5[5].data := @crom_bank5_world5[0];
  crom_bank5[5].size := 144;
  crom_bank5[6].data := @crom_bank5_world6[0];
  crom_bank5[6].size := 168;
  crom_bank5[7].data := @crom_bank5_world7[0];
  crom_bank5[7].size := 168;
  crom_bank5[8].data := @crom_bank5_world8[0];
  crom_bank5[8].size := 192;
  crom_bank5[9].data := @crom_bank5_world9[0];
  crom_bank5[9].size := 192;
  // bank7
  crom_bank7[0].data := @crom_bank7_world0[0];
  crom_bank7[0].size := 14;
  crom_bank7[1].data := @crom_bank7_world1[0];
  crom_bank7[1].size := 6;
  crom_bank7[2].data := @crom_bank7_world2[0];
  crom_bank7[2].size := 7;
  crom_bank7[3].data := @crom_bank7_world3[0];
  crom_bank7[3].size := 8;
  crom_bank7[4].data := @crom_bank7_world4[0];
  crom_bank7[4].size := 6;
  crom_bank7[5].data := @crom_bank7_world5[0];
  crom_bank7[5].size := 6;
  crom_bank7[6].data := @crom_bank7_world6[0];
  crom_bank7[6].size := 7;
  crom_bank7[7].data := @crom_bank7_world7[0];
  crom_bank7[7].size := 7;
  crom_bank7[8].data := @crom_bank7_world8[0];
  crom_bank7[8].size := 8;
  crom_bank7[9].data := @crom_bank7_world9[0];
  crom_bank7[9].size := 8;
end;

function rbisland_cchip_ram_r(direccion: word): word;
begin
  rbisland_cchip_ram_r := cram[current_bank, direccion shr 1];
end;

function rbisland_cchip_ctrl_r: word;
begin
  rbisland_cchip_ctrl_r := 1;
end;

procedure rbisland_cchip_ctrl_w;
begin
end;

procedure rbisland_cchip_bank_w(data: word);
begin
  current_bank := data and $7;
end;

procedure rbisland_cchip_ram_w(direccion, data: word);
begin
  cram[current_bank][direccion shr 1] := data;
end;

end.
